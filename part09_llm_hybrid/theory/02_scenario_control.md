# 🎭 02. シナリオ制御とLLMの活用

本節では、**タスクの流れや状況分岐を含む「シナリオ制御」**を  
LLM（大規模言語モデル）と組み合わせて柔軟に設計する方法について解説します。

---

## 🎯 シナリオ制御とは？

- 一連の状態遷移や判断ルールをもとに制御対象を動かす方式
- 代表例：ロボットの「起動 → 探索 → 発見 → 報告 → 充電」などの手続き

---

## 🔄 FSMとLLMによるハイブリッドシナリオ

| 構成要素 | 役割 |
|----------|------|
| FSM | 状態管理と基本遷移制御（if/elseの拡張） |
| LLM | 状況判断・次状態の推論・新規イベントへの適応 |

### ✅ 例：倉庫ロボット

```
FSM：
  - 状態A: 探索
  - 状態B: 搬送
  - 状態C: 充電
LLM：
  - 状況を見て「異常発生」と判断 → 状態D: 故障診断へ遷移
```

---

## 🧠 LLMが関与する部分

- 次の状態遷移を自然言語記述から判断
- 条件分岐や環境変化に応じた行動パターンの選択
- 状態追加・遷移追加などの「シナリオ拡張」

---

## 🧪 実験例：GPTによるシナリオ遷移制御

1. 状態テーブルを用意（FSM）
2. 状況記述（自然言語）を与える
3. ChatGPTに次の状態を尋ねる：
    ```python
    prompt = f"現在の状態は「搬送中」、周囲に障害物があります。次に取るべき状態は？"
    response = chatgpt_respond(prompt)
    → 返答：『障害物回避』状態へ遷移してください。
    ```

---

## ⚙️ Python実装例（概要）

- 状態定義：`states = ['IDLE', 'SEARCH', 'CARRY', 'AVOID', 'CHARGE']`
- LLM関数：
    ```python
    def next_state_from_llm(current_state, observation_text):
        # LLM APIへの問い合わせ
        return response_suggested_state
    ```

---

## 💡 応用可能な分野

- 自律移動ロボット、ドローン制御
- ゲームAI、教育ロボット
- 工場内のシナリオ自動化／異常対話対応

---

## 🔚 まとめ

- シナリオ制御はFSMで構成可能だが、LLMを加えることで**柔軟性と文脈理解が拡張**
- 人間との対話や動的環境に適応する「知能的なフロー制御」が実現可能

📄 次へ：[03_exception_handling.md](./03_exception_handling.md)
