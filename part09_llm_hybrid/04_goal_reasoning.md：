# 🎯 04. 目的推論と対話型制御

本節では、LLMの自然言語理解能力を活用して、  
「目的そのものの認識・修正・計画分解」を行う**知能的制御戦略**について解説します。

---

## 🤔 目的推論とは？

- 単なる命令実行ではなく、「何を目指すべきか」を推論・理解する過程
- 状況や対話に応じて目標そのものが変化する可能性がある
- プランニングや意図理解とも関連が深い

---

## 🧠 LLMによる目的推論の役割

| 機能 | 内容 |
|------|------|
| 意図理解 | 「充電せよ」の裏にある目的（バッテリー低下）を推定 |
| ゴール再構成 | 環境変化やユーザ指示で目的そのものを更新 |
| サブゴール生成 | 「探索 → 発見 → 運搬 → 充電」などのステップ提案 |
| 対話制御 | ユーザとの言語的インタラクションを通じた目標確認 |

---

## 💬 例：LLMによるゴール判断のプロンプト

```python
prompt = '''
あなたはロボットの知能制御モジュールです。
現在の状態は「移動中」、目の前に障害物があります。
目的は「最短で充電地点に到達する」。
最適な行動は？
'''
response = chatgpt_respond(prompt)
→ 返答：「障害物を回避し、最短経路を再計算して移動してください。」
```

---

## 📘 実装概要（agent構造）

```python
class GoalReasoningAgent:
    def __init__(self):
        self.goal = "探索"
    def update_goal(self, observation_text):
        prompt = f"現在の目的は「{self.goal}」。状況：{observation_text}。次の目的は？"
        self.goal = chatgpt_respond(prompt)
```

---

## 🔄 FSMとの接続

- FSMの遷移先状態や目標条件をLLMが柔軟に切り替える
- 状態遷移ではなく「目的の変更」に対応するアーキテクチャへ拡張可能

---

## 🧠 AITL構想における知性層の展開

- 本能層（FSM）… 状態の切り替え
- 理性層（PID）… 実時間制御
- **知性層（LLM）… 目的生成・修正・多段階判断**

---

## 🔚 まとめ

- ゴールベース制御は、**柔軟性・汎化性・自律性**を大きく向上させる
- LLMとの統合により「対話的・文脈的な制御」が現実的に可能となる

📁 次は：[`fsm_pid_llm_sim.py`](../simulation/fsm_pid_llm_sim.py) にて3層統合制御を実装します。

---
